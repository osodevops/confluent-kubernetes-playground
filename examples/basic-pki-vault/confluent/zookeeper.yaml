apiVersion: platform.confluent-rbac.io/v1beta1
kind: Zookeeper
metadata:
  name: zookeeper
spec:
  podTemplate:
    serviceAccountName: oso-confluent-rbac-vault-account
    annotations:
      vault.hashicorp.com/agent-inject: "true"
      vault.hashicorp.com/role: "oso-confluent-rbac-vault-role"
      vault.hashicorp.com/agent-inject-secret-server.cert: "pki_int/issue/sandbox.svc.cluster.local"
      vault.hashicorp.com/agent-inject-template-server.cert: |
        {{- with secret "pki_int/issue/sandbox.svc.cluster.local" "common_name=kafka.sandbox.svc.cluster.local" -}}
        {{ .Data.ca_chain }}
        {{ .Data.issuing_ca }}
        {{ .Data.certificate }}
        {{- end }}
      vault.hashicorp.com/agent-inject-secret-server.key: "pki_int/issue/sandbox.svc.cluster.local"
      vault.hashicorp.com/agent-inject-template-server.key: |
        {{- with secret "pki_int/issue/sandbox.svc.cluster.local" "common_name=kafka.sandbox.svc.cluster.local" -}}
        {{ .Data.private_key }}
        {{- end }}
  replicas: 1
  tls:
    autoGeneratedCerts: true