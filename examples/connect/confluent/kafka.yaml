apiVersion: platform.confluent.io/v1beta1
kind: Kafka
metadata:
  name: kafka
spec:
  configOverrides:
    server:
      - confluent.schema.registry.url=https://schemaregistry.sandbox.svc.cluster.local:8081
#      - ssl.endpoint.identification.algorithm=

      # Overwrite the default settings on the INTERNAL listener
      - listener.name.internal.sasl.enabled.mechanisms=PLAIN,OAUTHBEARER
      - listener.name.internal.plain.sasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required;
      - listener.name.internal.plain.sasl.server.callback.handler.class=io.confluent.security.auth.provider.ldap.LdapAuthenticateCallbackHandler
      - listener.name.internal.oauthbearer.sasl.jaas.config=org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required publicKeyPath="/mnt/secrets/kafka/mdsPublicKey.pem";
      - listener.name.internal.oauthbearer.sasl.login.callback.handler.class=io.confluent.kafka.server.plugins.auth.token.TokenBearerServerLoginCallbackHandler
      - listener.name.internal.oauthbearer.sasl.server.callback.handler.class=io.confluent.kafka.server.plugins.auth.token.TokenBearerValidatorCallbackHandler

      # Overwrite the default settings on the EXTERNAL listener
      - listener.name.external.sasl.enabled.mechanisms=PLAIN,OAUTHBEARER
      - listener.name.external.plain.sasl.jaas.config=org.apache.kafka.common.security.plain.PlainLoginModule required;
      - listener.name.external.plain.sasl.server.callback.handler.class=io.confluent.security.auth.provider.ldap.LdapAuthenticateCallbackHandler
      - listener.name.external.oauthbearer.sasl.jaas.config=org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required publicKeyPath="/mnt/secrets/kafka/mdsPublicKey.pem";
      - listener.name.external.oauthbearer.sasl.login.callback.handler.class=io.confluent.kafka.server.plugins.auth.token.TokenBearerServerLoginCallbackHandler
      - listener.name.external.oauthbearer.sasl.server.callback.handler.class=io.confluent.kafka.server.plugins.auth.token.TokenBearerValidatorCallbackHandler
  tls:
    autoGeneratedCerts: true
  listeners:
    internal:
      tls:
        enabled: true
    external:
      tls:
        enabled: true
  dependencies:
    zookeeper:
      endpoint: zookeeper.sandbox.svc.cluster.local:2182
      tls:
        enabled: true
