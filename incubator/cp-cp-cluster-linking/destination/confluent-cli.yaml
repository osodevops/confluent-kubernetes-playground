---
apiVersion: v1
kind: Pod
metadata:
  name: confluent-cli
spec:
  containers:
    - name: confluent-cli
      image: confluentinc/confluent-cli:latest
      env:
        - name: CONFLUENT_PLATFORM_USERNAME
          value: "kafka"
        - name: CONFLUENT_PLATFORM_PASSWORD
          value: "kafka-secret"
        - name: CONFLUENT_PLATFORM_MDS_URL
          value: "https://kafka.destination.svc.cluster.local:8090"
        - name: CONFLUENT_PLATFORM_CA_CERT_PATH
          value: "/secrets/kafka-generated-jks/ca.crt"
      command:
        - /bin/sh
        - -c
        - sleep 1000000000000000000
#        - |
          confluent kafka link create from-on-prem-link \
          --cluster uMF-aOdiRgGu6cHRLP0P1g \
          --source-cluster-id SMQhxcNZTRWLbVThFdIknQ \
          --config-file /mount/cluster-link-conf/clusterlink-hybrid-dst.config \
          --source-bootstrap-server 0.0.0.0
      volumeMounts:
      - mountPath: /secrets/mds-public
        name: mds-public
      - mountPath: /secrets/kafka-generated-jks
        name: kafka-generated-jks
      - mountPath: /mount/cluster-link-conf
        name: cluster-link-conf
  volumes:
    - name: mds-public
      secret:
        secretName: mds-public
    - name: kafka-generated-jks
      secret:
        secretName: kafka-generated-jks
    - name: cluster-link-conf
      configMap:
        defaultMode: 420
        name: cluster-link-conf
  restartPolicy: Always
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: cluster-link-conf
data:
  clusterlink-hybrid-dst.config: |-
    link.mode=DESTINATION
    connection.mode=INBOUND
  0_users.ldif: |-
    dn: ou=users,dc=test,dc=com
    objectClass: organizationalUnit
    objectClass: top
    ou: users
