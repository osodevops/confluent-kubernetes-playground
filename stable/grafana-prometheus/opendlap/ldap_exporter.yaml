apiVersion: v1
kind: Pod
metadata:
  name: ldap-exporter
  labels:
    app: ldap-exporter
spec:
  containers:
    - name: ldap-exporter
#      command: [ "/bin/bash", "-c", "--" ]
#      args: [ "while true; do sleep 30; done;" ]
      command: [ "/app/openldap_exporter-linux-amd64", "--config", "/conf/exporter.yaml"]
#        - /app/openldap_exporter-linux-amd64 --config /conf/exporter.yaml
      image: ldap-exporter:thisone
      imagePullPolicy: IfNotPresent
      volumeMounts:
      - mountPath: /conf
        name: exporter-conf
  volumes:
    - name: exporter-conf
      configMap:
        defaultMode: 420
        name: ldap-exporter
  restartPolicy: Always
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: ldap-exporter
data:
  exporter.yaml: |-
    ---
    ldapUser: "cn=mds,dc=test,dc=com"
    ldapPass: "Developer!"
    ldapAddr: "ldap:389"
    promAddr: ":9330"
---
apiVersion: v1
kind: Service
metadata:
  name: ldap-exporter
  labels:
    service: ldap-exporter-service
spec:
  type: ClusterIP
  ports:
    - port: 9330
      name: "ldapexporter"
      targetPort: 9330
      protocol: TCP
  selector:
    app: ldap-exporter



